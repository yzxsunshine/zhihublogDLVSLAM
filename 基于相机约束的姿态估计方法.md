# 基于相机约束的姿态估计方法 —— 上
在上一篇文章中，我们介绍了几种比较常见的特征点检测和匹配方法。在得到这些匹配的特征点后，便可以利用相机观测模型产生的种种约束来计算相机姿态了。这些约束一般分成两类：二维-二维约束和二维-三维约束。而约束的不同相应的求解方式也不尽相同。本文将会对这些方法进行一个简单的总结。

# 相机模型
## 投影模型
在正式开始介绍相机姿态估计方法之前，了解一下相机模型还是很有必要的。图1(a)中是比较典型的相机模型。三维点$M$在相机$C$的视窗内，经过投影后在图像平面的观测点为$m$。观测点$m$的颜色或灰度则由三维$M$点的材质，受到的光照，表面法线以及相机$C$的位置共同决定。有的visual SLAM会选择$z=1$作为图像平面，这样得到的二维投影方向与三维相同，比较直观(OpenCV calib3d)。而有的工作会使用$z=-1$，虽然二维点的x和y上的顺序会与三维空间相反，但这种描述方法更符合物理上的投影关系（Bundler）。所以这两种方案没有孰是孰非，但在使用一些开源库时需要注意一下他们使用的投影图像平面，避免出现一些奇怪的bug而找不到源头。

图1(b)中的是两中常见的图像空间表示方法。通常大家说的图像空间指得是以像素为单位，图片左上角为原点的表示方法。这种表示方法比较符合人类的阅读顺序，但转换到三维空间时需要将y轴反转，一个不留神就会犯错。因此很多SLAM工作会用左下角作为原点。接下来，将以像素为单位图像空间转换到以米为单位的三维空间时，需要用到相机的焦距(focal length)和光心（optical center），也就是大家熟知的内参（intrinsic parameters）了。在减去光心坐标并除以焦距后，像素点便会转换到$z=1$的XOY平面上。

## 畸变模型
相机的光学畸变通常是由光学元件制作时的缺陷导致的成像错位。这些光学畸变大体上可以分为两类：以光轴为中心对称的径向畸变（常表示为k_i，i为阶数 ），以及主光轴方向不对称的切向畸变（常表示为p_i，i为阶数）。在使用时，常常写作一个4维或5维的向量（k_1, k_2, p_1, p_2, k_3）。在得到畸变参数后，便可以根据相机畸变的多项式公式逆推得到非畸变的图像了。内参和畸变模型的标定目前已经有很多成熟的方案和工具，这里就不多介绍了。

## 三维空间刚体变换
物体在世界坐标系和相机坐标系之间的转换满足在特殊三维欧几里得空间（SE3）的刚体变换。SE3的相机姿态通常表示为4x4的转换矩阵或6维的相机姿态向量，二者之间可以用lie group的log和exp操作相互转换。SE3中主要包含旋转和平移两个部分。旋转的部分有多种表示方法，包括：Rodrigues数、欧拉角、四元数、Axis-Angle以及3x3的旋转矩阵。平移则是比较简单的三维向量。结合投影模型和刚体变换过程后，三维点便可以被转换到图像空间内。这些变换的具体过程都可以在这篇文章中找到https://zhuanlan.zhihu.com/p/32937868 。


# 通过二维与二维点匹配关系求解相机姿态
## 求解基础矩阵
基础矩阵是极线几何的线性代数（矩阵）表示形式。它最基本的特性是，如果两点x和x'是三维点X在图I和I'中的投影，则二者满足约束x^TFx'=0。而该约束的另一种形式可以表示为l'=Fx，其含义为图I中x点在I'中的匹配点一定在直线l'上。形成该约束的如下，在给定图I中点x以及两副图片之间的基础矩阵F时，由相机光心C为起点，沿点x在三维空间中可以形成一条射线，而三维点X一定位于该射线上。这条射线如果出现在图I'中时，它的投影一定也是一条直线l'。
图1

基础矩阵满足如下约束：
* 基础矩阵F的转置矩阵F^T同样具有几何意义：图I'到图I的基础矩阵
* 图I'的极点e'位于F的左乘零空间，而I的极点e位于F的右乘零空间，e'F=0，Fe=0
* 尽管基础矩阵为3x3有9个元素，基础矩阵F只有7个自由度，秩为2。这是由于在矩阵F的空间上总能找到极线对l和l'，二者上所有的点都能映射到对方的直线上。因此不满足双射函数（bijection）的条件，不满秩。

## 求解本质矩阵

# 通过三维与二维点匹配关系求解相机姿态
## 线性优化求解

## 非线性优化求解

# 小结与最后说两句
http://yzxsunshine.blogspot.com/2015/03/some-background-knowledge-for.html